@model List<ApplicationService.ViewModels.Card.Item>
@{
    ViewData["Title"] = "ViewAllSelectedItems";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<style>
    img {
        display: inline-block !important;
        width: auto !important;
        max-width: 100% !important;
        height: auto !important;
        max-height: 100% !important;
    }
</style>
<div class="row">
    <div class="col-md-12 col-sm-12">

        <table id="dtBasicExample" class="table table-striped  table-bordered col-sm-12" cellspacing="0" width="100%" >
            <thead>
                <tr>
                    <th class="th-sm">
                        Name
                    </th>

                    <th class="th-sm">
                        Price
                    </th>
                    <th class="th-sm">
                        Qunit
                    </th>
                    <th class="th-sm">
                        Total Price
                    </th>
                    <th class="th-sm">
                        Image
                    </th>
                    <th class="th-sm">
                        Click Here To View The Item
                    </th>
                    <th class="th-sm">
                       Remove
                    </th>
                </tr>
            </thead>
            <tbody>

                @foreach (var Item in Model)
                {

                    // note becareful when adding new culomn since the order is imporant
                <tr>
                    <td style="display:none">
                        @Item.Product.ItemId
                    </td>
                    <td style="display:none">
                        @Item.Product.JuiceId
                    </td>
                    <td style="display:none">
                        @Item.Product.JuiceMangmentId
                    </td>
                    <td>@Item.Product.Name</td>
                    <td>@Item.Product.Price</td>
                    <td>@Item.Quantity</td>
                    <td> @{ var x = @Item.Product.Price * @Item.Quantity;} @x</td>
                    <td>
                        @{ var image64 = System.Text.Encoding.UTF8.GetString(Item.Product.Photo);
                            var imgSrc = String.Format("data:image/jpeg;base64,/{0}", image64);
                            <img src="@imgSrc" />
                        }
                    </td>
                    <td>
                        @if (Item.Product.ItemId != 0)
                        {
                            <a href="@Url.Action("ViewItemDetails","Customer", new { id=Item.Product.ItemId } )">Click</a>
                        }
                        else
                        {
                            <a href="@Url.Action("ViewJuiceDetails","Customer", new { id=Item.Product.JuiceId } )">Click</a>
                        }
                    </td>
                    <td>
                        <p>Click Here</p>
                    </td>
                </tr>
                }

            </tbody>
            <tfoot>
                <tr>
                    <th>
                        Name
                    </th>
                    <th>
                        Position
                    </th>
                    <th>
                        Office
                    </th>
                    <th>
                        Age
                    </th>
                    <th>
                        Start date
                    </th>
                    <th>
                        Salary
                    </th>
                </tr>
            </tfoot>
        </table>

    </div>
</div>



<script>
    $(document).ready(function () {
        debugger;
        var table = $('#dtBasicExample');
        $('#dtBasicExample tbody').on('click', 'p', function () {
            debugger;

            var currentRow = $(this).closest("tr");
            var Item = {
                ItemId: Number(currentRow.find("td:eq(0)").text().trim()),
                JuiceId: Number(currentRow.find("td:eq(1)").text().trim()),
                JuiceMangmentId: Number(currentRow.find("td:eq(2)").text().trim()),
                Quantity: 0
            }
            debugger;
        $.ajax(
            {
                url: '@Url.Action("Remove", "Customer")',
                contentType: 'application/json; charset=utf-8',
                datatype: 'json',
                data: JSON.stringify(Item),
                type: "POST",
                success: function () {
                    debugger;

                    currentRow.remove()
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    debugger;
                    if (xhr.status == 403)
                    {
                        alert("You need to login first :)");
                        window.location.href = '/Identity/Account/Login';
                    }
                }
            });
        });
        });

</script>